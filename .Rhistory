mutate(rank = 1:n)
ggplot(d, aes(rank, sorted_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red")
View(d)
library(tidyverse)
nom_pval <- c(0.01600000, 0.05865014, 0.08350898, 0.08783160, 0.06777848,
0.08206850, 0.01800000, 0.09725057, 0.00200000, 0.00010000,
0.04862445, 0.00300000, 0.01500000, 0.07574901, 0.05959104,
0.01900000, 0.01700000, 0.00400000, 0.02000000, 0.06827007)
n <- length(nom_pval)
d <- tibble(pvalID = 1:n, nom_pval = nom_pval) %>%
mutate(sorted_pval = sort(nom_pval)) %>%
arrange(sorted_pval) %>%
mutate(rank = 1:n)
View(d)
library(tidyverse)
nom_pval <- c(0.01600000, 0.05865014, 0.08350898, 0.08783160, 0.06777848,
0.08206850, 0.01800000, 0.09725057, 0.00200000, 0.00010000,
0.04862445, 0.00300000, 0.01500000, 0.07574901, 0.05959104,
0.01900000, 0.01700000, 0.00400000, 0.02000000, 0.06827007)
n <- length(nom_pval)
d <- tibble(pvalID = 1:n, nom_pval = nom_pval) %>%
mutate(sorted_pval = sort(nom_pval)) %>%
arrange(sorted_pval) %>%
mutate(rank = 1:n)
View(d)
d <- tibble(pvalID = 1:n, nom_pval = nom_pval)
View(d)
d <- tibble(pvalID = 1:n, nom_pval = nom_pval) %>%
mutate(sorted_pval = sort(nom_pval)) %>%
arrange(sorted_pval)
View(d)
d <- tibble(sorted_pval = sort(nom_pval))
View(d)
d <- tibble(sorted_pval = sort(nom_pval), rank = 1:n)
View(d)
ggplot(d, aes(rank, sorted_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red")
ggplot(d, aes(rank, sorted_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red")
ggplot(d, aes(rank, sorted_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
blogdown:::update_meta_addin()
blogdown:::update_meta_addin()
library(ggrepel)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank)
View(d)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) -> jj
View(jj)
which(jj$is.under == T)
which.max(jj$is.under == T)
which(jj$is.under == T)
which(jj$is.under == T) %>% max()
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max()))
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max()), "sig.", "non-sig.")
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
xaringan:::inf_mr()
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval, color = sig)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
dev.off()
dev.off()
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval, color = sig)) +
geom_point() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval, color = sig)) +
geom_point() +
scale_color_d3() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max()), "last rank under the line", "") %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank under the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval, color = sig)) +
geom_point() +
scale_color_d3() +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank under the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval, color = sig)) +
geom_point() +
scale_color_d3() +
geom_text_repel(aes(label = repel_text)) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank under the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text)) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text)) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
?geom_text_repel
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text), segment.size = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text)) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red", arrow = T) +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text)) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red", nudge_x = 1) +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text), arrow = T) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(d, aes(rank, sorted_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue")
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(d, aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue")
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue")
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(rev_pval = sorted_pval*n/rank)
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
xaringan:::inf_mr()
d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig.")) %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
xaringan:::inf_mr()
# Chunk 1
library(tidyverse)
library(ggrepel)
library(ggsci)
nom_pval <- c(0.01600000, 0.05865014, 0.08350898, 0.08783160, 0.06777848,
0.08206850, 0.01800000, 0.09725057, 0.00200000, 0.00010000,
0.04862445, 0.00300000, 0.01500000, 0.07574901, 0.05959104,
0.01900000, 0.01700000, 0.00400000, 0.02000000, 0.06827007)
n <- length(nom_pval)
d <- tibble(sorted_pval = sort(nom_pval), rank = 1:n)
d <- d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(repel_text = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
d %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = repel_text), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(is.last = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
d %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.last), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
# Chunk 1
library(tidyverse)
library(ggrepel)
library(ggsci)
nom_pval <- c(0.01600000, 0.05865014, 0.08350898, 0.08783160, 0.06777848,
0.08206850, 0.01800000, 0.09725057, 0.00200000, 0.00010000,
0.04862445, 0.00300000, 0.01500000, 0.07574901, 0.05959104,
0.01900000, 0.01700000, 0.00400000, 0.02000000, 0.06827007)
n <- length(nom_pval)
d <- tibble(sorted_pval = sort(nom_pval), rank = 1:n)
# Chunk 2
d <- d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(is.last = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
d %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.last), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
head(d)
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha))
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha, "problem", ""))
d %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha, "problem", ""))
d %>%
ggplot(aes(rank, rev_pval)) +
geom_point() +
geom_text_repel(aes(label = is.problem), nudge_x = 1) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha, "problem", ""))
d %>%
ggplot(aes(rank, rev_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.problem), nudge_x = 1) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha, "problem", ""))
d %>%
ggplot(aes(rank, rev_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.problem)) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
p.adjust
p <- nom_pval
lp <- 20
i <- lp:1L
o <- order(p, decreasing = TRUE)
ro <- order(o)
p[o]
cummin(q * n/i * p[o]
)
q
cummin(n/i * p[o])
n/i * p[o]
getwd()
xaringan:::inf_mr()
xaringan:::inf_mr()
xaringan:::inf_mr()
# Chunk 1
library(tidyverse)
library(ggrepel)
library(ggsci)
nom_pval <- c(0.01600000, 0.05865014, 0.08350898, 0.08783160, 0.06777848,
0.08206850, 0.01800000, 0.09725057, 0.00200000, 0.00010000,
0.04862445, 0.00300000, 0.01500000, 0.07574901, 0.05959104,
0.01900000, 0.01700000, 0.00400000, 0.02000000, 0.06827007)
n <- length(nom_pval)
d <- tibble(sorted_pval = sort(nom_pval), rank = 1:n)
# Chunk 2
d <- d %>%
mutate(is.under = sorted_pval <= alpha/n*rank) %>%
mutate(is.last = ifelse(rank == which(.$is.under) %>% max(), "last rank\nunder the line", "")) %>%
mutate(sig = ifelse(rank <= which(.$is.under) %>% max(), "sig.", "non-sig."))
d %>%
ggplot(aes(rank, sorted_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.last), nudge_x = 1) +
ylim(c(0, NA)) +
geom_abline(intercept = 0, slope = alpha/n, color = "red") +
theme_classic() +
theme(aspect.ratio = 1)
# Chunk 3
d <- d %>%
mutate(rev_pval = sorted_pval*n/rank) %>%
mutate(is.problem = ifelse(sig == "sig." & rev_pval > alpha, "problem", ""))
d %>%
ggplot(aes(rank, rev_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.problem), nudge_x = 1) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
names(d)
d$sorted_pval
?sort
d1 <- d %>%
mutate(reverse_rev_pval = sort(rev_pval, decreasing = T))
View(d1)
p.adjust
d1 <- d %>%
mutate(reverse_rev_pval = sort(rev_pval, decreasing = T))
d1 <- d %>%
mutate(reverse_rev_pval = sort(rev_pval, decreasing = T))
View(d1)
d1$reverse_rev_pval
d1 <- d %>%
mutate(reverse_rev_pval = sort(rev_pval, decreasing = T))
d1 %>%
ggplot(aes(rank, reverse_rev_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.problem), nudge_x = 1) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(adj_pval = p.adjust(sorted_pval, method = "BH"))
d <- d %>%
mutate(adj_pval = p.adjust(sorted_pval, method = "BH"))
d %>%
ggplot(aes(rank, adj_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
geom_text_repel(aes(label = is.problem), nudge_x = 1) +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(adj_pval = p.adjust(sorted_pval, method = "BH"))
d %>%
ggplot(aes(rank, adj_pval)) +
geom_point(aes(y = rev_pval)) +
geom_point(aes(color = sig)) +
scale_color_d3() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(adj_pval = p.adjust(sorted_pval, method = "BH"))
d %>%
ggplot(aes(rank, adj_pval)) +
geom_point(aes(y = rev_pval), shape = "wrong") +
geom_point(aes(color = sig), shape = "correct") +
scale_color_d3() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
d <- d %>%
mutate(adj_pval = p.adjust(sorted_pval, method = "BH"))
d %>%
ggplot(aes(rank, adj_pval)) +
geom_point(aes(y = rev_pval, shape = "wrong")) +
geom_point(aes(color = sig, shape = "correct")) +
scale_color_d3() +
ylim(c(0, NA)) +
geom_hline(yintercept = alpha, color = "blue") +
theme_classic() +
theme(aspect.ratio = 1)
xaringan:::inf_mr()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::update_meta_addin()
getwd()
